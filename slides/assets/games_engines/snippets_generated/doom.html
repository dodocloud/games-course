<pre><table><tr><td><span class="linenum">   1</span></td><td> boolean <span class="token function">P_CheckMissileRange</span> <span class="token punctuation">(</span>mobj_t<span class="token operator">*</span> actor<span class="token punctuation">)</span><span class="token punctuation">{</span>   </td></tr>
<tr><td><span class="linenum">   2</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">P_CheckSight</span><span class="token punctuation">(</span>actor<span class="token punctuation">,</span> actor<span class="token operator">-></span>target<span class="token punctuation">)</span><span class="token punctuation">)</span></td></tr>
<tr><td><span class="linenum">   3</span></td><td>     <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// canâ€™t see the target</span></td></tr>
<tr><td><span class="linenum">   4</span></td><td>    </td></tr>
<tr><td><span class="linenum">   5</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span> actor<span class="token operator">-></span>flags <span class="token operator">&amp;</span> MF_JUSTHIT <span class="token punctuation">)</span> <span class="token punctuation">{</span></td></tr>
<tr><td><span class="linenum">   6</span></td><td>     <span class="token comment">// just hit -> fight back!</span></td></tr>
<tr><td><span class="linenum">   7</span></td><td>       actor<span class="token operator">-></span>flags <span class="token operator">&amp;=</span> <span class="token operator">~</span>MF_JUSTHIT<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   8</span></td><td>       <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   9</span></td><td>     <span class="token punctuation">}</span></td></tr>
<tr><td><span class="linenum">  10</span></td><td>    </td></tr>
<tr><td><span class="linenum">  11</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span>actor<span class="token operator">-></span>reactiontime<span class="token punctuation">)</span></td></tr>
<tr><td><span class="linenum">  12</span></td><td>     <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// do not attack yet</span></td></tr>
<tr><td><span class="linenum">  13</span></td><td>    </td></tr>
<tr><td><span class="linenum">  14</span></td><td>     dist <span class="token operator">=</span> <span class="token function">P_AproxDistance</span> <span class="token punctuation">(</span>actor<span class="token punctuation">,</span> target<span class="token punctuation">)</span></td></tr>
<tr><td><span class="linenum">  15</span></td><td>     <span class="token operator">-</span> <span class="token number">64</span><span class="token operator">*</span>FRACUNIT<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  16</span></td><td>    </td></tr>
<tr><td><span class="linenum">  17</span></td><td>     <span class="token comment">// no melee attack, so fire more</span></td></tr>
<tr><td><span class="linenum">  18</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>actor<span class="token operator">-></span>info<span class="token operator">-></span>meleestate<span class="token punctuation">)</span></td></tr>
<tr><td><span class="linenum">  19</span></td><td>      dist <span class="token operator">-=</span> <span class="token number">128</span><span class="token operator">*</span>FRACUNIT<span class="token punctuation">;</span> </td></tr>
<tr><td><span class="linenum">  20</span></td><td>   </td></tr>
<tr><td><span class="linenum">  21</span></td><td>     <span class="token comment">// check for ARCH-VILE</span></td></tr>
<tr><td><span class="linenum">  22</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span>actor<span class="token operator">-></span>type <span class="token operator">==</span> MT_VILE<span class="token punctuation">)</span><span class="token punctuation">{</span></td></tr>
<tr><td><span class="linenum">  23</span></td><td>       <span class="token keyword">if</span> <span class="token punctuation">(</span>dist <span class="token operator">></span> <span class="token number">14</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">)</span></td></tr>
<tr><td><span class="linenum">  24</span></td><td>          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// too far away</span></td></tr>
<tr><td><span class="linenum">  25</span></td><td>     <span class="token punctuation">}</span></td></tr>
<tr><td><span class="linenum">  26</span></td><td> <span class="token punctuation">}</span></td></tr></table></pre>