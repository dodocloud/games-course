<pre><span class="linenum">   1</span> <span class="token comment">// Returns 1 if the cheat was successful, 0 if failed.</span>
<span class="linenum">   2</span> <span class="token keyword">int</span> <span class="token function">cht_CheckCheat</span><span class="token punctuation">(</span>cheatseq_t<span class="token operator">*</span> cht<span class="token punctuation">,</span> <span class="token keyword">char</span> key <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="linenum">   3</span>     <span class="token keyword">int</span> i<span class="token punctuation">;</span>
<span class="linenum">   4</span>     <span class="token keyword">int</span> rc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="linenum">   5</span>  
<span class="linenum">   6</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>firsttime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="linenum">   7</span>       firsttime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="linenum">   8</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> cheat_xlate_table<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SCRAMBLE</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="linenum">   9</span>     <span class="token punctuation">}</span>
<span class="linenum">  10</span>  
<span class="linenum">  11</span>     <span class="token comment">// initialize if first time</span>
<span class="linenum">  12</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cht<span class="token operator">-></span>p<span class="token punctuation">)</span> cht<span class="token operator">-></span>p <span class="token operator">=</span> cht<span class="token operator">-></span>sequence<span class="token punctuation">;</span>
<span class="linenum">  13</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>cht<span class="token operator">-></span>p <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span>cht<span class="token operator">-></span>p<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">=</span> key<span class="token punctuation">;</span>
<span class="linenum">  14</span>     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cheat_xlate_table<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>key<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">*</span>cht<span class="token operator">-></span>p<span class="token punctuation">)</span> cht<span class="token operator">-></span>p<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="linenum">  15</span>     <span class="token keyword">else</span> cht<span class="token operator">-></span>p <span class="token operator">=</span> cht<span class="token operator">-></span>sequence<span class="token punctuation">;</span>
<span class="linenum">  16</span>  
<span class="linenum">  17</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>cht<span class="token operator">-></span>p <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> cht<span class="token operator">-></span>p<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="linenum">  18</span>     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>cht<span class="token operator">-></span>p <span class="token operator">==</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// end of sequence character</span>
<span class="linenum">  19</span>         cht<span class="token operator">-></span>p <span class="token operator">=</span> cht<span class="token operator">-></span>sequence<span class="token punctuation">;</span>
<span class="linenum highlight">  20</span> <span class="highlight">        rc = 1;</span>
<span class="linenum">  21</span>     <span class="token punctuation">}</span>
<span class="linenum">  22</span>     <span class="token keyword">return</span> rc<span class="token punctuation">;</span>
<span class="linenum">  23</span> <span class="token punctuation">}</span></pre>