<pre><table><tr><td><span class="linenum">   1</span></td><td> <span class="token comment">// Returns 1 if the cheat was successful, 0 if failed.</span></td></tr>
<tr><td><span class="linenum">   2</span></td><td> <span class="token keyword">int</span> <span class="token function">cht_CheckCheat</span><span class="token punctuation">(</span>cheatseq_t<span class="token operator">*</span> cht<span class="token punctuation">,</span> <span class="token keyword">char</span> key <span class="token punctuation">)</span> <span class="token punctuation">{</span></td></tr>
<tr><td><span class="linenum">   3</span></td><td>     <span class="token keyword">int</span> i<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   4</span></td><td>     <span class="token keyword">int</span> rc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   5</span></td><td>  </td></tr>
<tr><td><span class="linenum">   6</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span>firsttime<span class="token punctuation">)</span> <span class="token punctuation">{</span></td></tr>
<tr><td><span class="linenum">   7</span></td><td>       firsttime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   8</span></td><td>       <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> cheat_xlate_table<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SCRAMBLE</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   9</span></td><td>     <span class="token punctuation">}</span></td></tr>
<tr><td><span class="linenum">  10</span></td><td>  </td></tr>
<tr><td><span class="linenum">  11</span></td><td>     <span class="token comment">// initialize if first time</span></td></tr>
<tr><td><span class="linenum">  12</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cht<span class="token operator">-></span>p<span class="token punctuation">)</span> cht<span class="token operator">-></span>p <span class="token operator">=</span> cht<span class="token operator">-></span>sequence<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  13</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>cht<span class="token operator">-></span>p <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span>cht<span class="token operator">-></span>p<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">=</span> key<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  14</span></td><td>     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cheat_xlate_table<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>key<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">*</span>cht<span class="token operator">-></span>p<span class="token punctuation">)</span> cht<span class="token operator">-></span>p<span class="token operator">++</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  15</span></td><td>     <span class="token keyword">else</span> cht<span class="token operator">-></span>p <span class="token operator">=</span> cht<span class="token operator">-></span>sequence<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  16</span></td><td>  </td></tr>
<tr><td><span class="linenum">  17</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>cht<span class="token operator">-></span>p <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> cht<span class="token operator">-></span>p<span class="token operator">++</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  18</span></td><td>     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>cht<span class="token operator">-></span>p <span class="token operator">==</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// end of sequence character</span></td></tr>
<tr><td><span class="linenum">  19</span></td><td>         cht<span class="token operator">-></span>p <span class="token operator">=</span> cht<span class="token operator">-></span>sequence<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum highlight">  20</span></td> <td><span class="highlight">        rc = 1;</span></td></tr>
<tr><td><span class="linenum">  21</span></td><td>     <span class="token punctuation">}</span></td></tr>
<tr><td><span class="linenum">  22</span></td><td>     <span class="token keyword">return</span> rc<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  23</span></td><td> <span class="token punctuation">}</span></td></tr></table></pre>