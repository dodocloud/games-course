<pre><table><tr><td><span class="linenum">   1</span></td><td> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">AllocatorReserve</span><span class="token punctuation">(</span>AllocatorBlock<span class="token operator">*</span> allocator<span class="token punctuation">)</span> <span class="token punctuation">{</span></td></tr>
<tr><td><span class="linenum">   2</span></td><td>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allocator<span class="token operator">-></span>free_<span class="token punctuation">)</span> <span class="token punctuation">{</span></td></tr>
<tr><td><span class="linenum">   3</span></td><td>         <span class="token comment">// Free nodes have been exhausted. Allocate a new larger block</span></td></tr>
<tr><td><span class="linenum">   4</span></td><td>         <span class="token keyword">unsigned</span> newCapacity <span class="token operator">=</span> <span class="token punctuation">(</span>allocator<span class="token operator">-></span>capacity_ <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   5</span></td><td>         <span class="token function">AllocatorReserveBlock</span><span class="token punctuation">(</span>allocator<span class="token punctuation">,</span> allocator<span class="token operator">-></span>nodeSize_<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   6</span></td><td>         allocator<span class="token operator">-></span>capacity_ <span class="token operator">+=</span> newCapacity<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">   7</span></td><td>     <span class="token punctuation">}</span></td></tr>
<tr><td><span class="linenum">   8</span></td><td>  </td></tr>
<tr><td><span class="linenum">   9</span></td><td>     <span class="token comment">// We should have new free node(s) chained</span></td></tr>
<tr><td><span class="linenum">  10</span></td><td>     AllocatorNode<span class="token operator">*</span> freeNode <span class="token operator">=</span> allocator<span class="token operator">-></span>free_<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  11</span></td><td>     <span class="token keyword">void</span><span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">reinterpret_cast</span><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>freeNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>AllocatorNode<span class="token punctuation">)</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  12</span></td><td>     allocator<span class="token operator">-></span>free_ <span class="token operator">=</span> freeNode<span class="token operator">-></span>next_<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  13</span></td><td>     freeNode<span class="token operator">-></span>next_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  14</span></td><td>     <span class="token keyword">return</span> ptr<span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  15</span></td><td> <span class="token punctuation">}</span></td></tr>
<tr><td><span class="linenum">  16</span></td><td> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></td></tr>
<tr><td><span class="linenum">  17</span></td><td> <span class="token comment">// create node from void* and call the constructor</span></td></tr>
<tr><td><span class="linenum highlight">  18</span></td> <td><span class="highlight">  Node* newNode = static_cast<Node*>(AllocatorReserve(allocator_));</span></td></tr>
<tr><td><span class="linenum">  19</span></td><td> <span class="token keyword">new</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span> <span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  20</span></td><td> <span class="token comment">// ... do some stuff </span></td></tr>
<tr><td><span class="linenum">  21</span></td><td> <span class="token comment">// delete node</span></td></tr>
<tr><td><span class="linenum">  22</span></td><td> <span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token operator">-></span><span class="token operator">~</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></td></tr>
<tr><td><span class="linenum">  23</span></td><td> <span class="token function">AllocatorFree</span><span class="token punctuation">(</span>allocator_<span class="token punctuation">,</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span></td></tr></table></pre>