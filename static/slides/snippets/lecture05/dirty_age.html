<p><span style="color:#E040FB;">void</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#40C4FF;">Node</span><span style="color:#F8F8F0;">::</span><span style="color:#B2FF59;">MarkDirty</span><span style="color:#F8F8F0;">()&nbsp;{</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#aaa;">//&nbsp;a)&nbsp;whenever&nbsp;a&nbsp;node&nbsp;is&nbsp;marked&nbsp;dirty,&nbsp;all&nbsp;its&nbsp;children&nbsp;are&nbsp;marked&nbsp;dirty&nbsp;as&nbsp;well.</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#aaa;">//&nbsp;b)&nbsp;whenever&nbsp;a&nbsp;node&nbsp;is&nbsp;cleared&nbsp;from&nbsp;being&nbsp;dirty,&nbsp;all&nbsp;its&nbsp;parents&nbsp;must&nbsp;have&nbsp;been</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#aaa;">//&nbsp;cleared&nbsp;as&nbsp;well.</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#FF5252;">if</span><span style="color:#F8F8F0;">&nbsp;(</span><span style="color:#40C4FF;">this</span><span style="color:#F8F8F0;">-&gt;</span><span style="color:#40C4FF;">dirty_</span><span style="color:#F8F8F0;">)&nbsp;</span><span style="color:#FF5252;">return</span><span style="color:#F8F8F0;">;</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#40C4FF;">this</span><span style="color:#F8F8F0;">-&gt;</span><span style="color:#40C4FF;">dirty_</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FFAB40;">true</span><span style="color:#F8F8F0;">;</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#aaa;">//&nbsp;Notify&nbsp;listener&nbsp;components&nbsp;first,&nbsp;then&nbsp;mark&nbsp;child&nbsp;nodes</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#FF5252;">for</span><span style="color:#F8F8F0;">&nbsp;(</span><span style="color:#E040FB;">auto</span><span style="color:#F8F8F0;">&nbsp;i&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#40C4FF;">this</span><span style="color:#F8F8F0;">-&gt;</span><span style="color:#40C4FF;">listeners_.</span><span style="color:#B2FF59;">Begin</span><span style="color:#F8F8F0;">(); i&nbsp;</span><span style="color:#FF5252;">!=</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#40C4FF;">this</span><span style="color:#F8F8F0;">-&gt;</span><span style="color:#40C4FF;">listeners_.</span><span style="color:#B2FF59;">End</span><span style="color:#F8F8F0;">();)&nbsp;{</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; Component&nbsp;</span><span style="color:#FF5252;">*</span><span style="color:#F8F8F0;">c&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FF5252;">*</span><span style="color:#F8F8F0;">i;</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:#FF5252;">if</span><span style="color:#F8F8F0;">&nbsp;(c) {</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;</span><span style="color:#B2FF59;">OnMarkedDirty</span><span style="color:#F8F8F0;">(</span><span style="color:#40C4FF;">this</span><span style="color:#F8F8F0;">);</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:#FF5252;">++</span><span style="color:#F8F8F0;">i;</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; }&nbsp;</span><span style="color:#FF5252;">else</span><span style="color:#F8F8F0;">&nbsp;{</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:#FF5252;">*</span><span style="color:#F8F8F0;">i&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#40C4FF;">this</span><span style="color:#F8F8F0;">-&gt;</span><span style="color:#40C4FF;">listeners_.</span><span style="color:#B2FF59;">Back</span><span style="color:#F8F8F0;">();&nbsp;</span><span style="color:#aaa;">//&nbsp;listener&nbsp;expired&nbsp;-&gt;&nbsp;erase&nbsp;from&nbsp;list</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:#40C4FF;">this</span><span style="color:#F8F8F0;">-&gt;</span><span style="color:#40C4FF;">listeners_.</span><span style="color:#B2FF59;">Pop</span><span style="color:#F8F8F0;">();</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; }</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; }</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#aaa;">//&nbsp;Mark&nbsp;all&nbsp;children&nbsp;dirty</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;&nbsp;</span><span style="color:#FF5252;">for</span><span style="color:#F8F8F0;">(</span><span style="color:#E040FB;">auto</span><span style="color:#F8F8F0;">&nbsp;child : children) {</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; child-&gt;</span><span style="color:#B2FF59;">MarkDirty</span><span style="color:#F8F8F0;">();</span></p>
  <p><span style="color:#F8F8F0;">&nbsp; }</span></p>
  <p><span style="color:#F8F8F0;">}</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;</span></p>
  <p><span style="color:#F8F8F0;">&nbsp;</span></p>