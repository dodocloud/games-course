<p><span style="color:#E040FB;">void</span><span style="color:#FF5252;">*</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#B2FF59;">AllocatorReserve</span><span style="color:#F8F8F0;">(AllocatorBlock</span><span style="color:#FF5252;">*</span><span style="color:#FFAB40;">&nbsp;allocator</span><span style="color:#F8F8F0;">)&nbsp;{</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp;&nbsp;</span><span style="color:#FF5252;">if</span><span style="color:#F8F8F0;">&nbsp;(</span><span style="color:#FF5252;">!</span><span style="color:#F8F8F0;">allocator-&gt;</span><span style="color:#40C4FF;">free_</span><span style="color:#F8F8F0;">)&nbsp;{</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:#aaa;">//&nbsp;Free&nbsp;nodes&nbsp;have&nbsp;been&nbsp;exhausted.&nbsp;Allocate&nbsp;a&nbsp;new&nbsp;larger&nbsp;block</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:#E040FB;">unsigned</span><span style="color:#F8F8F0;">&nbsp;newCapacity&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;(allocator-&gt;</span><span style="color:#40C4FF;">capacity_</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FF5252;">+</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FFAB40;">1</span><span style="color:#F8F8F0;">)&nbsp;</span><span style="color:#FF5252;">&gt;&gt;</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FFAB40;">1</span><span style="color:#F8F8F0;">;</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:#B2FF59;">AllocatorReserveBlock</span><span style="color:#F8F8F0;">(allocator,&nbsp;allocator-&gt;</span><span style="color:#40C4FF;">nodeSize_</span><span style="color:#F8F8F0;">,&nbsp;newCapacity);</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp; &nbsp; &nbsp; allocator-&gt;</span><span style="color:#40C4FF;">capacity_</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FF5252;">+=</span><span style="color:#F8F8F0;">&nbsp;newCapacity;</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp; }</span></p>
<p><span style="color:#F8F8F0;">&nbsp;</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp;&nbsp;</span><span style="color:#aaa;">//&nbsp;We&nbsp;should&nbsp;have&nbsp;new&nbsp;free&nbsp;node(s)&nbsp;chained</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp; AllocatorNode</span><span style="color:#FF5252;">*</span><span style="color:#F8F8F0;">&nbsp;freeNode&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;allocator-&gt;</span><span style="color:#40C4FF;">free_</span><span style="color:#F8F8F0;">;</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp;&nbsp;</span><span style="color:#E040FB;">void</span><span style="color:#FF5252;">*</span><span style="color:#F8F8F0;">&nbsp;ptr&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;(</span><span style="color:#FF5252;">reinterpret_cast&lt;</span><span style="color:#E040FB;">unsigned</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#E040FB;">char</span><span style="color:#FF5252;">*&gt;</span><span style="color:#F8F8F0;">(freeNode))&nbsp;</span><span style="color:#FF5252;">+</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FF5252;">sizeof</span><span style="color:#F8F8F0;">(AllocatorNode);</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp; allocator-&gt;</span><span style="color:#40C4FF;">free_</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;freeNode-&gt;</span><span style="color:#40C4FF;">next_</span><span style="color:#F8F8F0;">;</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp; freeNode-&gt;</span><span style="color:#40C4FF;">next_</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FF5252;">=</span><span style="color:#F8F8F0;">&nbsp;</span><span style="color:#FFAB40;">0</span><span style="color:#F8F8F0;">;</span></p>
<p><span style="color:#F8F8F0;">&nbsp; &nbsp;&nbsp;</span><span style="color:#FF5252;">return</span><span style="color:#F8F8F0;">&nbsp;ptr;</span></p>
<p><span style="color:#F8F8F0;">}</span></p>
<p><span style="color:#FF5252;">============================</span></p>
<p><span style="color:#aaa;">//&nbsp;create&nbsp;node&nbsp;from&nbsp;void*&nbsp;and&nbsp;call&nbsp;the&nbsp;constructor</span></p>
<p><span style="color:yellow;">Node*&nbsp;newNode&nbsp;=&nbsp;static_cast&lt;Node*&gt;(AllocatorReserve(allocator_));</span></p>
<p><span style="color:#FF5252;">new</span><span style="color:#F8F8F0;">(newNode)&nbsp;</span><span style="color:#B2FF59;">Node</span><span style="color:#F8F8F0;">();</span></p>
<p><span style="color:#aaa;">// ... do some stuff&nbsp;</span></p>
<p><span style="color:#aaa;">//&nbsp;delete&nbsp;node</span></p>
<p><span style="color:#F8F8F0;">(newNode)</span><span style="color:#FF5252;">-&gt;</span><span style="color:#B2FF59;">~Node</span><span style="color:#F8F8F0;">();</span></p>
<p><span style="color:#B2FF59;">AllocatorFree</span><span style="color:#F8F8F0;">(allocator_, newNode);</span></p>